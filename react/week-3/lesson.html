
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Week 15 - Fetching Data Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../week-4/lesson.html" />
    
    
    <link rel="prev" href="../week-2/lesson.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Course</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Before you start
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../others/lesson0.html">
            
                <a href="../../others/lesson0.html">
            
                    
                    Week 0 - Introduction and basic setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../others/house-rules.html">
            
                <a href="../../others/house-rules.html">
            
                    
                    House Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../CODE_OF_CONDUCT.html">
            
                <a href="../../CODE_OF_CONDUCT.html">
            
                    
                    Code of Conduct
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../html-css/">
            
                <a href="../../html-css/">
            
                    
                    HTML/CSS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../html-css/week-1/lesson.html">
            
                <a href="../../html-css/week-1/lesson.html">
            
                    
                    Week 1 - Semantic HTML and CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../html-css/week-2/lesson.html">
            
                <a href="../../html-css/week-2/lesson.html">
            
                    
                    Week 2 - Responsive Web and layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../html-css/week-3/lesson.html">
            
                <a href="../../html-css/week-3/lesson.html">
            
                    
                    Week 3 - Bootstrap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../js-core/">
            
                <a href="../../js-core/">
            
                    
                    JavaScript I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../js-core/week-04/lesson.html">
            
                <a href="../../js-core/week-04/lesson.html">
            
                    
                    Week 4 - Hello JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../js-core/week-05/lesson.html">
            
                <a href="../../js-core/week-05/lesson.html">
            
                    
                    Week 5 - Expressions and loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../js-core/week-06/lesson.html">
            
                <a href="../../js-core/week-06/lesson.html">
            
                    
                    Week 6 - Arrays and callbacks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../js-core-2/">
            
                <a href="../../js-core-2/">
            
                    
                    JavaScript II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../js-core-2/week-07/lesson.html">
            
                <a href="../../js-core-2/week-07/lesson.html">
            
                    
                    Week 7 - Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../js-core-2/week-08/lesson.html">
            
                <a href="../../js-core-2/week-08/lesson.html">
            
                    
                    Week 8 - JS in the Browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../js-core-2/week-09/lesson.html">
            
                <a href="../../js-core-2/week-09/lesson.html">
            
                    
                    Week 9 - More JS in the Browser 
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../js-core-3/">
            
                <a href="../../js-core-3/">
            
                    
                    JavaScript III
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../js-core-3/week-10/lesson.html">
            
                <a href="../../js-core-3/week-10/lesson.html">
            
                    
                    Week 10 - ES6 and debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../js-core-3/week-11/lesson.html">
            
                <a href="../../js-core-3/week-11/lesson.html">
            
                    
                    Week 11 - Fetch and API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../js-core-3/week-12/lesson.html">
            
                <a href="../../js-core-3/week-12/lesson.html">
            
                    
                    Week 12 - Project
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../">
            
                <a href="../">
            
                    
                    React
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../week-1/lesson.html">
            
                <a href="../week-1/lesson.html">
            
                    
                    Week 13 - React 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../week-2/lesson.html">
            
                <a href="../week-2/lesson.html">
            
                    
                    Week 14 - Reacting to Changes
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.3" data-path="lesson.html">
            
                <a href="lesson.html">
            
                    
                    Week 15 - Fetching Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../week-4/lesson.html">
            
                <a href="../week-4/lesson.html">
            
                    
                    Routing (optional)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../classes-optional/lesson.html">
            
                <a href="../classes-optional/lesson.html">
            
                    
                    Class components (optional)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../node/">
            
                <a href="../../node/">
            
                    
                    Node/DB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../node/week-13/lesson.html">
            
                <a href="../../node/week-13/lesson.html">
            
                    
                    Week 16 - Node and Express 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../node/week-14/lesson.html">
            
                <a href="../../node/week-14/lesson.html">
            
                    
                    Week 17 - More APIs in Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../db/week-1/lesson.html">
            
                <a href="../../db/week-1/lesson.html">
            
                    
                    Week 18 - Introduction to SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../db/week-2/lesson.html">
            
                <a href="../../db/week-2/lesson.html">
            
                    
                    Week 19 - More SQL and integration with NodeJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../db/week-3/lesson.html">
            
                <a href="../../db/week-3/lesson.html">
            
                    
                    Week 20 - SQL with NodeJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../db/week-4/lesson.html">
            
                <a href="../../db/week-4/lesson.html">
            
                    
                    Week 21 - NodeJS Workshop
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Useful information</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../others/useful-links.html">
            
                <a href="../../others/useful-links.html">
            
                    
                    Useful links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../others/PRACTICES.html">
            
                <a href="../../others/PRACTICES.html">
            
                    
                    Coding Standards and Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../others/career-development.html">
            
                <a href="../../others/career-development.html">
            
                    
                    Career Development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other resources</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../others/git.html">
            
                <a href="../../others/git.html">
            
                    
                    Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../others/coding-101.html">
            
                <a href="../../others/coding-101.html">
            
                    
                    Coding 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../others/aws-workshop-2.html">
            
                <a href="../../others/aws-workshop-2.html">
            
                    
                    AWS - DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <a target="_blank" href="https://github.com/Thomas-Stewart/syllabus/tree/master/java">
            
                    
                    Java module
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">For Mentors</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../others/mentors-guide.html">
            
                <a href="../../others/mentors-guide.html">
            
                    
                    Mentors Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../others/mentors-weeks.html">
            
                <a href="../../others/mentors-weeks.html">
            
                    
                    Mentors Weekly Contents
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Week 15 - Fetching Data</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="react---week-3">React - Week 3</h1>
<p><strong>What will we learn today?</strong></p>
<ul>
<li><a href="#recap">Recap</a></li>
<li><a href="#updating-data-fetching-when-props-change">Updating Data Fetching when Props Change</a></li>
<li><a href="#working-with-forms-in-react">Working with forms in React</a></li>
</ul>
<h2 id="recap">Recap</h2>
<p>Last week we looked at using props and state to create React components that change with user input (<a href="https://codesandbox.io/s/react-3-state-recap-38x3b?file=/src/Counter.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span>
</code></pre>
<h2 id="fetching-data-in-react">Fetching Data in React</h2>
<p>Often when you create a React app, you will want to fetch data from an API and display it inside your components. How do we do this in React?</p>
<p>You might think that we could just fetch the data in the component like this, but unfortunately it <strong>won&apos;t work</strong> (<a href="https://codesandbox.io/s/async-data-fetching-in-react-not-working-fnfyu?file=/src/MartianPhotoFetcher.js" target="_blank">interactive example</a>):</p>
<p>:::danger
This code won&apos;t work!
:::</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">MartianPhotoFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> imgSrc <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token function">fetch</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=2015-6-3&amp;api_key=DEMO_KEY</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      imgSrc <span class="token operator">=</span> data<span class="token punctuation">.</span>photos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>img_src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The image src is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>imgSrc<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>imgSrc<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This is because React is synchronous, while <code>fetch</code> is asynchronous. If we look in the console, we&apos;ll see that the <code>imgSrc</code> will always be <code>null</code> when we try to render it. React will try to render before <code>fetch</code> has had time to get the data from the API.</p>
<p><img src="../assets/data-fetching-timeline-problem.png" alt=""></p>
<p>We need a way of running the <code>fetch</code> call <strong>after</strong> we have rendered for the first time, so that it is not <em>racing</em> against React updating the DOM. Then once we have got the data back we can use state to tell React to re-render with the new data.</p>
<p><img src="../assets/data-fetching-timeline-solution.png" alt=""></p>
<p>The way we do this is with another Hook, provided by React. This one is called <code>useEffect</code>.</p>
<h3 id="importing-useeffect">Importing <code>useEffect</code></h3>
<p>Just like <code>useState</code>, we will import <code>useEffect</code> into our file like this (<a href="https://codesandbox.io/s/importing-useeffect-hook-mij5v?file=/src/App.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>useEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>If we look in the console, we&apos;ll see that <code>useEffect</code> is also a function like <code>useState</code>.</p>
<p>Often, we will need to use <code>useState</code> and <code>useEffect</code> together. They are imported together like this:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="using-useeffect">Using <code>useEffect</code></h3>
<p>Now let&apos;s look at how to use the <code>useEffect</code> Hook (<a href="https://codesandbox.io/s/basic-useeffect-example-jf6id?file=/src/HelloUseEffect.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">MartianPhotoFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=2015-6-3&amp;api_key=DEMO_KEY</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Always remember to put an empty array here!</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello useEffect<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>useEffect</code> Hook takes two arguments:</p>
<ol>
<li>A callback function, where we can put our <code>fetch</code> call. In this example, we&apos;re fetching some data from the NASA API! &#xF0;&#x178;&#x161;&#x20AC;</li>
<li>An array, which we&apos;ll look at later but is very important that you don&apos;t forget it!</li>
</ol>
<p>:::tip
When writing your <code>useEffect</code>, write the &quot;skeleton&quot; first, then fill in the callback function later.</p>
<pre class="language-"><code class="lang-js"><span class="token comment">// Write this bit first!</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Write this bit later!</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>:::</p>
<p>You might have noticed that we still haven&apos;t rendered the data from the API. We now need to tell React to re-render once we get the data. This sounds like a job for state!</p>
<p>Let&apos;s look an example of how we can use state and <code>useEffect</code> to do this (<a href="https://codesandbox.io/s/using-the-useeffect-hook-jtz5u?file=/src/MartianPhotoFetcher.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">MartianPhotoFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>marsPhotoData<span class="token punctuation">,</span> setMarsPhotoData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Fetching data from NASA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fetch</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=2015-6-3&amp;api_key=DEMO_KEY</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setMarsPhotoData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>marsPhotoData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>marsPhotoData<span class="token punctuation">.</span>photos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>img_src<span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">&quot;Martian surface&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The timeline of this component is now what we wanted at the start:</p>
<ol>
<li>The component renders for the first time. Notice that we are returning <code>null</code> here: if a component returns <code>null</code>, then React will render nothing on-screen</li>
<li>After rendering, the <code>useEffect</code> callback is run, so it fetches data from the NASA API</li>
<li>When the response is received, we update the state</li>
<li>This causes a re-render so that we can show the data on-screen</li>
</ol>
<p>You might notice that even though we re-rendered, we did <strong>not</strong> run the <code>useEffect</code> a second time. The way we&apos;ve set it up, <code>useEffect</code> will only run after the <strong>first</strong> time a component renders. We&apos;ll look at controlling this in more detail later.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise A (estimate: 15 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Open the <code>pokedex</code> React application again.</td>
</tr>
<tr>
<td style="text-align:left">2. Create a new file <code>src/PokemonMoves.js</code>, and copy/paste the code from <a href="https://codesandbox.io/s/pokemonmoves-useeffect-exercise-starting-point-f1mwm?file=/src/PokemonMoves.js" target="_blank">this CodeSandbox</a>.</td>
</tr>
<tr>
<td style="text-align:left">3. Render the <code>PokemonMoves</code> component inside the <code>App</code> component (underneath <code>CaughtPokemon</code>).</td>
</tr>
<tr>
<td style="text-align:left">4. Take a few minutes to read the code in the new <code>PokemonMoves</code> component. Discuss with another student why you think it doesn&apos;t work.</td>
</tr>
<tr>
<td style="text-align:left">5. Create a new state variable called <code>pokemonData</code> and initialise it to <code>null</code>. <details><summary>Click here if you are stuck.</summary>Check last week&apos;s lesson for a reminder on creating state variables.</details></td>
</tr>
<tr>
<td style="text-align:left">6. Now add a <code>useEffect</code> call, but leave the callback function empty for now. <strong>Make sure you remember to add the empty array after the callback function</strong>.</td>
</tr>
<tr>
<td style="text-align:left">7. Inside the <code>useEffect</code> callback, call the <code>fetch</code> function with this URL: <code>https://pokeapi.co/api/v2/pokemon/1/</code>.</td>
</tr>
<tr>
<td style="text-align:left">8. Add a <code>.then</code> handler into the <code>fetch</code> function (remember this needs to come immediately after the <code>fetch</code> call) which converts the response from JSON (hint: <code>.then(res =&gt; res.json())</code>).</td>
</tr>
<tr>
<td style="text-align:left">9. Add a second <code>.then</code> handler after the one we just added, where the callback function will receive an argument called <code>data</code>.</td>
</tr>
<tr>
<td style="text-align:left">11. Within the second <code>.then</code> callback function, log out the data that we just received (hint: <code>console.log(data)</code>). Inspect the data in the dev tools console. Is there any interesting data? (Hint: think about what the component is trying to render).</td>
</tr>
<tr>
<td style="text-align:left">12. Still within the second <code>.then</code> callback, set the <code>pokemonData</code> state to be the <code>data</code> object we received from the API.</td>
</tr>
<tr>
<td style="text-align:left">13. What happens in your browser? Do you understand why? If not, discuss it with another student. If you are both stuck, ask a Teaching Assistant.</td>
</tr>
</tbody>
</table>
<h3 id="conditional-rendering">Conditional rendering</h3>
<p>In the <code>MartianPhotoFetcher</code> component above, we wrapped our JSX inside an <code>if</code> / <code>else</code> statement. This is common practice in React, as it allows us to show something different depending on the situation (for example if there is no data to display, show the user something else instead).</p>
<p>You may also see this done in 2 other ways:</p>
<h4 id="the-ternary-operator--">The ternary operator <code>? :</code></h4>
<p>The <em>ternary operator</em> follows this structure <code>condition ? outputIfTrue : outputIfFalse</code> (<a href="https://codesandbox.io/s/conditional-rendering-with-ternary-operator-tjro6?file=/src/MartianPhotoFetcher.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>marsPhotoData <span class="token operator">?</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>marsPhotoData<span class="token punctuation">.</span>photos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>img_src<span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">&quot;Martian surface&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="the-double-ampersand-">The double ampersand <code>&amp;&amp;</code></h4>
<p>The double ampersand <code>&amp;&amp;</code> is used when you don&apos;t have an <code>else</code>. The implication is that when the condition is not fulfilled, nothing will render (<a href="https://codesandbox.io/s/conditional-rendering-with-double-ampersand-1b5t9?file=/src/MartianPhotoFetcher.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>marsPhotoData <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>marsPhotoData<span class="token punctuation">.</span>photos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>img_src<span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">&quot;Martian surface&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You&apos;ll notice in the <code>&amp;&amp;</code> example above, we do not render a &apos;Loading...&apos; message, because there is no alternative output (no <code>else</code> case).</p>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise B (estimate: 5 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Open the <code>pokedex</code> application and the <code>src/PokemonMoves.js</code> file.</td>
</tr>
<tr>
<td style="text-align:left">2. Change the <code>if</code> / <code>else</code> statement in your JSX to use the ternary operator (<code>condition ? outputIfTrue : outputIfFalse</code>) instead.</td>
</tr>
</tbody>
</table>
<h3 id="the-circle-of-life">The Circle of Life</h3>
<p>We now know how to fetch data and render it in our React applications. However, there was a problem with the method that just learned. To understand this problem we first have to understand the <em>lifecycle</em> of a component.</p>
<p>Let&apos;s take a look at an example:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise C (estimate: 10 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Open <a href="https://codesandbox.io/s/fetch-with-prop-updates-not-working-x1dox?file=/src/App.js" target="_blank">this CodeSandbox</a>.</td>
</tr>
<tr>
<td style="text-align:left">2. Take 5 minutes to read the code.</td>
</tr>
<tr>
<td style="text-align:left">3. Click the &quot;Fetch image for 2019&quot; button. <strong>If you&apos;re feeling confident</strong>: predict what is going to happen before you click the button.</td>
</tr>
<tr>
<td style="text-align:left">4. Now click the &quot;Fetch image for 2020&quot; button. What did you expect to happen? What actually happened? Can you explain why?</td>
</tr>
</tbody>
</table>
<p>Together let&apos;s &quot;play computer&quot; to break down exactly what is happening with these components:</p>
<ol>
<li>When the page loads, the <code>App</code> function component is called</li>
<li>It doesn&apos;t have any <code>date</code> state already, so we initialise it to an empty string (<code>&quot;&quot;</code>) with <code>useState</code></li>
<li>It renders the 2 buttons, but because <code>date</code> is an empty string, it does <strong>not</strong> render the <code>MartianImageFetcher</code> component. Instead <code>null</code> is returned, which means that nothing is rendered</li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>date<span class="token punctuation">,</span> setDate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">...</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handle2019Click<span class="token punctuation">}</span><span class="token operator">&gt;</span>Fetch image <span class="token keyword">for</span> <span class="token number">2019</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handle2020Click<span class="token punctuation">}</span><span class="token operator">&gt;</span>Fetch image <span class="token keyword">for</span> <span class="token number">2020</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

        <span class="token punctuation">{</span>date <span class="token operator">?</span> <span class="token operator">&lt;</span>MartianImageFetcher photoDate<span class="token operator">=</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<ol>
<li>When we click the &quot;Fetch image for 2019&quot; button, the <code>handle2019Click</code> click handler is called</li>
<li>The state is set by <code>setDate</code> to be <code>&quot;2019-01-01&quot;</code>, and a re-render is triggered</li>
<li>The <code>App</code> function component is called again</li>
<li>This time, <code>useState</code> remembers that we have <code>date</code> state and it is set to <code>&quot;2019-01-01&quot;</code></li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">function</span> <span class="token function">handle2019Click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token string">&quot;2019-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">...</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">...</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handle2019Click<span class="token punctuation">}</span><span class="token operator">&gt;</span>Fetch image <span class="token keyword">for</span> <span class="token number">2019</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">...</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<ol>
<li>Now <code>App</code> <strong>does</strong> render <code>MartianImageFetcher</code> and passes the <code>date</code> state as a prop named <code>photoDate</code></li>
<li>The <code>MartianImageFetcher</code> function component is called for the first time</li>
<li><code>useState</code> knows that we haven&apos;t got any <code>imgSrc</code> state so initialises it to <code>null</code></li>
<li>We queue an effect, which will run after we render for the first time</li>
<li>Because the <code>imgSrc</code> state is set to <code>null</code>, we return <code>null</code>. This means that nothing is rendered</li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">MartianImageFetcher</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>imgSrc<span class="token punctuation">,</span> setImgSrc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>imgSrc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>imgSrc<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre>
<ol>
<li>Now that the component has rendered for the first time, the effect is run</li>
<li>A <code>fetch</code> request is made to the NASA API</li>
<li>When the request data comes back, we set the <code>imgSrc</code> state to a piece of the data, which triggers a re-render</li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">MartianImageFetcher</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
          props<span class="token punctuation">.</span>date
        <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;api_key=gnesiqnKCJMm8UTYZYi86ZA5RAnrO4TAR9gDstVb</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setImgSrc</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>photos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>img_src<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
</code></pre>
<ol>
<li>The <code>MartianImageFetcher</code> function component is called again</li>
<li><code>useState</code> remembers that the <code>imgSrc</code> state is set to the data from the API</li>
<li>This time, we do <strong>not</strong> queue an effect. We set up <code>useEffect</code> with an empty array (<code>[]</code>), which means that we only run after the <strong>first</strong> render</li>
<li>We do have <code>imgSrc</code> state set, so we render the image using the data from the API &#xF0;&#x178;&#x17D;&#x2030;</li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">MartianImageFetcher</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>imgSrc<span class="token punctuation">,</span> setImgSrc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">...</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>imgSrc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>imgSrc<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>Phew! That was a lot of work just to render an image! But we&apos;re not quite done yet, we still need to find out what happens when we click the &quot;Fetch image for 2020&quot; button:</p>
<ol>
<li>In the <code>App</code> component, the <code>handle2020Click</code> click handler is called</li>
<li>The <code>date</code> state is set to <code>&quot;2020-01-01&quot;</code> and a re-render is triggered</li>
<li>The <code>App</code> function component is called again and the <code>date</code> state is set to <code>&quot;2020-01-01&quot;</code></li>
<li>The <code>date</code> prop that is passed to <code>MartianImageFetcher</code> is <strong>different</strong> which means that it has to re-render</li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">function</span> <span class="token function">handle2020Click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token string">&quot;2020-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">...</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">...</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">...</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handle2020Click<span class="token punctuation">}</span><span class="token operator">&gt;</span>Fetch image <span class="token keyword">for</span> <span class="token number">2020</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">...</span>
        <span class="token punctuation">{</span>date <span class="token operator">?</span> <span class="token operator">&lt;</span>MartianImageFetcher photoDate<span class="token operator">=</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
        <span class="token operator">...</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">...</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<ol>
<li>In the <code>MartianImageFetcher</code> component <code>useState</code> remembers that we already had <code>imgSrc</code> state. It is set to the image from 2019</li>
<li>Again, we do <strong>not</strong> queue the effect because this is a re-render and <code>useEffect</code> has been passed an empty array <code>[]</code></li>
<li>Because <code>imgSrc</code> state has been set previously we render the image from 2019</li>
</ol>
<pre class="language-"><code class="lang-js">  <span class="token keyword">function</span> <span class="token function">MartianImageFetcher</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>imgSrc<span class="token punctuation">,</span> setImgSrc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>imgSrc<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise D (estimate: 5 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Did you spot where the bug was? Discuss with a group of 2 - 3 students where you think the bug is.</td>
</tr>
<tr>
<td style="text-align:left">2. Report back to the rest of the class where you think the bug happened.</td>
</tr>
</tbody>
</table>
<details>
<summary>Click here to reveal the answer!</summary>

The key that the `useEffect` in `MartianImageFetcher` is **only run once**. This is because we told React that the queue should be queued on the first render only. However, as we saw, sometimes you need the effect to run again when some data changes. In this case the `date` prop, changed from `&quot;2019-01-01&quot;` to `&quot;2020-01-01&quot;`, meaning that we have to fetch data different data. We call this a _dependency_ of the effect. Any variables which are used inside the `useEffect` callback function are dependencies.

</details>

<h3 id="useeffect-dependencies-array"><code>useEffect</code> dependencies array</h3>
<p>To solve this problem, we can tell React to queue the effect on the first render <strong>and</strong> when a dependency changes. We do this by adding the dependency variable to the array (<a href="https://codesandbox.io/s/fetch-with-prop-updates-working-64vw3?file=/src/App.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">MartianImageFetcher</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>imgSrc<span class="token punctuation">,</span> setImgSrc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>photoDate<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now when the <code>photoDate</code> prop changes, React knows that the effect must be run again, this time with the 2020 date. Because of this behaviour, the second argument to <code>useEffect</code> is called the <em>dependencies argument</em>. We use it whenever we have something in our effect function that <em>depends</em> on a variable outside of the effect function.</p>
<p>Here&apos;s a diagram showing when the <code>useEffect</code> callback will be run:</p>
<p><img src="../assets/when-will-use-effect-be-run.png" alt=""></p>
<p>To help you understand this better, try &quot;playing computer&quot; again, but this time think about what happens when we use <code>[props.photoDate]</code> for the dependencies argument. Think carefully about what changes with step 6 after we click the 2020 button.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise E (estimate: 10 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Open the <code>pokedex</code> React application.</td>
</tr>
<tr>
<td style="text-align:left">2. Create a new file <code>src/PokemonMovesSelector.js</code>. Copy/paste the code from <a href="https://codesandbox.io/s/pokemonmovesselector-exercise-starting-point-wt5d0" target="_blank">this CodeSandbox</a> into the new file.</td>
</tr>
<tr>
<td style="text-align:left">3. Open <code>src/App.js</code> and replace the <code>PokemonMoves</code> component with the <code>PokemonMovesSelector</code> component (remember to update the <code>import</code> too!)</td>
</tr>
<tr>
<td style="text-align:left">4. Take a few minutes to read what the <code>PokemonMovesSelector</code> component does. If you have questions, ask a Teaching Assistant to help. We <strong>won&apos;t</strong> need to make any more changes to this component.</td>
</tr>
<tr>
<td style="text-align:left">5. Open the <code>PokemonMoves</code> component again. Change the URL to use backticks (<code>`...` </code>) instead of double-quotes (<code>&quot;...&quot;</code>). Then replace the hard-coded number 1 with <code>${props.pokemonId}</code>. What will this do? <details><summary>Click here if you don&apos;t know</summary>The URL will contain the <code>pokemonId</code> instead of always fetching the Pokemon with id of 1</details></td>
</tr>
<tr>
<td style="text-align:left">6. Open your browser and find where the <code>PokemonMovesSelector</code> component is rendered. <strong>Before you click the buttons</strong>, think about what you expect will happen. Then click the &quot;Fetch Bulbasaur&quot; button to find out what actually happens.</td>
</tr>
<tr>
<td style="text-align:left">7. Refresh the page. What happens now if you click the &quot;Fetch Bulbasaur&quot; button, then click the &quot;Fetch Charmander&quot; button? Is this what you expected? Discuss with another student why this happens.</td>
</tr>
<tr>
<td style="text-align:left">8. Fix the bug by adding <code>props.pokemonId</code> to the <code>useEffect</code> dependencies array in <code>PokemonMoves</code>. Remember that you can test if the bug still happens by refreshing the page, clicking one of the buttons, then the other button.</td>
</tr>
</tbody>
</table>
<h3 id="eslint-rules-for-react-hooks">ESLint rules for React Hooks</h3>
<p>As you may have noticed, VSCode highlighted the empty dependencies array when you changed the URL passed to <code>fetch</code> in <code>PokemonMoves</code>.</p>
<p>This is because your React application is using the rules from <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank"><code>eslint-plugin-react-hooks</code></a>, a package created by the developers who make React. It helps you to find bugs in React Hooks code by highlighting places where you might be missing dependencies.</p>
<p>If you see a red squiggly line underneath your <code>useEffect</code> dependencies array, you can hover your mouse over and it will tell you which variable is missing so you can add it to the dependencies array. Here&apos;s an example:</p>
<p><img src="../assets/eslint-hooks-rule.png" alt=""></p>
<h2 id="working-with-forms-in-react">Working with forms in React</h2>
<p>Modern web applications often involve interacting with forms such as creating an account, adding a blog post or posting a comment. This would involve using inputs, buttons and various form elements and being able to get the values entered by users to do something with it (like display them on a page or send them in a POST request). So, how do we do this in React?</p>
<h3 id="controlled-component-pattern">Controlled component pattern</h3>
<p>A popular pattern for building forms and collect user data is the <em>controlled component</em> pattern. A <em>pattern</em> is a repeated solution to a problem that is useful in multiple similar cases. Let&apos;s have a look at an example (<a href="https://codesandbox.io/s/controlled-component-4jq1yqy8kx?file=/src/SimpleReminder.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SimpleReminder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>reminder<span class="token punctuation">,</span> setReminder<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setReminder</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
        placeholder<span class="token operator">=</span><span class="token string">&quot;Some reminder&quot;</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>reminder<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Today <span class="token constant">I</span> need to remember to<span class="token operator">...</span> <span class="token punctuation">{</span>reminder<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We&apos;re controlling the <code>value</code> of the input by using the value from the <code>reminder</code> state. This means that we can only change the value by updating the state.</p>
<p>It is done using the <code>onChange</code> attribute and the <code>handleChange</code> function which is called every time the input value changes (typically when a new character is added or removed).</p>
<p>If we didn&apos;t call <code>setReminder</code> in the <code>handleChange</code> function, then the input&apos;s value would never change and it would appear as if you couldn&apos;t type in the input! Finally, the value we keep in the <code>reminder</code> state is displayed on the screen as today&apos;s reminder.</p>
<p>In addition, instead of just saving the value of the input in the state, we could have also transformed the string before we set it with <code>setReminder</code>, for example by calling <code>toUpperCase()</code> on the string.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise F (estimate: 10 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Open the <code>pokedex</code> React application.</td>
</tr>
<tr>
<td style="text-align:left">2. Create a new file <code>src/PokemonCity.js</code>. Copy/paste the code from <a href="https://codesandbox.io/s/pokemon-city-exercise-starting-point-6wivm?file=/src/PokemonCity.js" target="_blank">this CodeSandbox</a> into the new file.</td>
</tr>
<tr>
<td style="text-align:left">3. Open the <code>src/App.js</code> file and render the new <code>PokemonCity</code> component (underneath <code>PokemonMovesSelector</code>).</td>
</tr>
<tr>
<td style="text-align:left">4. Take a few minutes to understand what the <code>PokemonCity</code> component does.</td>
</tr>
<tr>
<td style="text-align:left">5. Add an <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></code> element above the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></code> element.</td>
</tr>
<tr>
<td style="text-align:left">6. Set the <code>value</code> attribute of the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> to the <code>city</code> state.</td>
</tr>
<tr>
<td style="text-align:left">7. Create a function within the component called <code>updateCity</code>. Pass this function to the <code>onChange</code> event handler.</td>
</tr>
<tr>
<td style="text-align:left">8. Change the <code>updateCity</code> component so that it has a parameter named <code>event</code>.</td>
</tr>
<tr>
<td style="text-align:left">9. Add a <code>console.log</code> to inspect the value of <code>event.target.value</code>. What happens when you type in the input?</td>
</tr>
<tr>
<td style="text-align:left">10. Using <code>setCity</code>, update the city state to what was typed in the input box.</td>
</tr>
</tbody>
</table>
<h3 id="form-with-multiple-fields">Form with Multiple Fields</h3>
<p>Let&apos;s have a look at a more complex example where we want to build a form to let users enter information to create a personal account (<a href="https://codesandbox.io/s/controlled-component-with-multiple-fields-qy3cd?file=/src/CreateAccountForm.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">CreateAccountForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">,</span> setEmail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>password<span class="token punctuation">,</span> setPassword<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleUsernameChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setUsername</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">handleEmailChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setEmail</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">handlePasswordChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setPassword</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
          name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span>
          placeholder<span class="token operator">=</span><span class="token string">&quot;Username&quot;</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleUsernameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
          name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span>
          placeholder<span class="token operator">=</span><span class="token string">&quot;Email&quot;</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>email<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleEmailChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span>
          name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span>
          placeholder<span class="token operator">=</span><span class="token string">&quot;Password&quot;</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>password<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handlePasswordChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We now have three different inputs named <code>username</code>, <code>email</code> and <code>password</code>. There is a corresponding state variable and change handler function for each value.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Exercise G (estimate: 10 min)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1. Open the <code>pokedex</code> React application again and open the <code>src/CaughtPokemon.js</code> file.</td>
</tr>
<tr>
<td style="text-align:left">2. Render an <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> before the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span></code> (hint: <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></code>).</td>
</tr>
<tr>
<td style="text-align:left">3. Create a new state variable called <code>pokemonNameInput</code> and initialise to an empty string (<code>&quot;&quot;</code>).</td>
</tr>
<tr>
<td style="text-align:left">4. Add a <code>value</code> attribute to the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> which is set to the <code>pokemonNameInput</code> state variable. (Hint: <code>value={pokemonNameInput}</code>)</td>
</tr>
<tr>
<td style="text-align:left">5. Create a new <code>handleInputChange</code> function within the component.</td>
</tr>
<tr>
<td style="text-align:left">6. Add a <code>onChange</code> handler to the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> that will call <code>handleInputChange</code>.</td>
</tr>
<tr>
<td style="text-align:left">7. Add a parameter called <code>event</code> to the <code>handleInputChange</code> function. Set the <code>pokemonNameInput</code> state variable to <code>event.target.value</code>. Try typing in the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> again. What happens now?</td>
</tr>
<tr>
<td style="text-align:left">8. Change the <code>catchPokemon</code> function to add the <code>pokemonNameInput</code> state to the <code>caught</code> array (hint: change the value that we are passing to the <code>concat</code> method)</td>
</tr>
<tr>
<td style="text-align:left">9. Open your browser, type a Pokemon name into the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> and click on the &quot;Catch Pokemon&quot; button. Do you see your new Pokemon being added to the list?</td>
</tr>
<tr>
<td style="text-align:left">10. Empty the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> after clicking on the button. To do this, set the state of <code>pokemonNameInput</code> to an empty string <code>&quot;&quot;</code> after we have added it to the <code>caught</code> array in the <code>catchPokemon</code> function.</td>
</tr>
<tr>
<td style="text-align:left">11: <strong>(STRETCH GOAL)</strong> Make sure the user cannot add a Pokemon to the <code>caught</code> state if the value of <code>pokemonNameInput</code> state is empty.</td>
</tr>
</tbody>
</table>
<h4 id="inlining-event-handlers">Inlining event handlers</h4>
<p>We could make our code a bit shorter if we <em>inlined</em> our event handlers (<a href="https://codesandbox.io/s/controlled-component-with-inlined-event-handlers-wfq8o?file=/src/CreateAccountForm.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token operator">&lt;</span>input
  type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
  name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span>
  placeholder<span class="token operator">=</span><span class="token string">&quot;Username&quot;</span>
  value<span class="token operator">=</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span>
  onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setUsername</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
<h4 id="centralising-event-handlers">Centralising event handlers</h4>
<p>Sometimes we need to put all of our update logic in one function, maybe because we need to validate the user&apos;s input before we set it in state.</p>
<p>We can use a single <code>handleChange</code> function, that is reused to keep track of changes for <strong>all</strong> of the form fields. To be able to tell which <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> is being updated, we check the <code>event.target.name</code> field. This corresponds to the <code>name</code> attribute on the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span></code> (e.g. <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></code>).</p>
<p>Based on this value, we then decide which state to update (<a href="https://codesandbox.io/s/controlled-component-with-centralised-handlers-1z90l?file=/src/CreateAccountForm.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setUsername</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setEmail</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setPassword</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="form-submission">Form submission</h3>
<p>So far, our form examples don&apos;t have a way of sending the user data back to the server, so that we can store it in the database.</p>
<p>We will be using a special <code>submit</code> event triggered on the <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span></code> element. This event is triggered when the user clicks a submit button or if they hit the Enter key. Let&apos;s take a look at an example (<a href="https://codesandbox.io/s/controlled-component-with-submit-handler-5uhih?file=/src/CreateAccountForm.js" target="_blank">interactive example</a>):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">CreateAccountForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token operator">...</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sending data to server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://httpstat.us/200&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        username<span class="token operator">:</span> username<span class="token punctuation">,</span>
        email<span class="token operator">:</span> email<span class="token punctuation">,</span>
        password<span class="token operator">:</span> password
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">...</span>
      <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>Submit<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We set up our <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span></code> to handle the event by passing the <code>handleSubmit</code> function to the <code>onSubmit</code> prop. If we click on the Submit button or hit Enter while focused on the form, the event is triggered and the <code>handleSubmit</code> function is called.</p>
<p>The first thing we do inside the handler function is call <code>event.preventDefault()</code>. This is necessary because the browser has a <em>default</em> action when the submit event is triggered on the form to send a GET request to the server. We prevent the default action because we will handle the event ourselves.</p>
<p>We can then do whatever we want with our user data! In this example, we&apos;re sending a POST request using the <code>fetch</code> method.</p>
<h2 id="further-reading">Further Reading</h2>
<h3 id="container-components">Container components</h3>
<p>There is a common pattern when loading data in React applications, called <em>container components</em>.</p>
<p><a href="further-reading/container-components">Read more about it here.</a></p>
<h3 id="multiple-fields-as-state-pattern">Multiple fields as state pattern</h3>
<p>There is another common pattern for handling multiple fields in a form, but it requires some JavaScript functionality that you may not have seen before.</p>
<p><a href="further-reading/multiple-form-fields">Read more about it here.</a></p>
<h1 id="homework">Homework</h1>
<ol>
<li>If you haven&apos;t already, complete the in-class exercises on your <code>pokedex</code> app</li>
<li>Complete all of the lesson 3 exercises in the <a href="https://github.com/CodeYourFuture/cyf-hotel-react#lesson-3" target="_blank">cyf-hotel-react</a> project</li>
<li>Try to complete the <a href="https://github.com/CodeYourFuture/cyf-hotel-react#stretch-goals" target="_blank">Stretch Goal exercises</a> in the cyf-hotel-react homework</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../week-2/lesson.html" class="navigation navigation-prev " aria-label="Previous page: Week 14 - Reacting to Changes">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../week-4/lesson.html" class="navigation navigation-next " aria-label="Next page: Routing (optional)">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Week 15 - Fetching Data","level":"1.7.3","depth":2,"next":{"title":"Routing (optional)","level":"1.7.4","depth":2,"path":"react/week-4/lesson.md","ref":"react/week-4/lesson.md","articles":[]},"previous":{"title":"Week 14 - Reacting to Changes","level":"1.7.2","depth":2,"path":"react/week-2/lesson.md","ref":"react/week-2/lesson.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["prism","-highlight","todo","scripts"],"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"scripts":{"files":["./checkboxRemember.js"]},"todo":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"react/week-3/lesson.md","mtime":"2021-01-12T12:40:16.453Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-01-12T12:41:04.413Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-scripts/865192367b808254b99cb0ba7092e452-checkboxRemember.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

